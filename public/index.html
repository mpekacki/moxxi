<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    </head>
    <body>
        <div id="app" class="container">
            Your unique endpoint is {{ serverUrl }}
            <ul class="list-group">
                <li v-for="request in requests" class="list-group-item">
                    <table class="table">
                        <tr>
                            <td>url</td>
                            <td>{{ request.url }}</td>
                        </tr>
                        <tr>
                            <td>method</td>
                            <td>{{ request.method }}</td>
                        </tr>
                        <tr>
                            <td>headers</td>
                            <td>{{ request.headers }}</td>
                        </tr>
                        <tr>
                            <td>params</td>
                            <td>{{ request.params }}</td>
                        </tr>
                        <tr>
                            <td>body</td>
                            <td>{{ request.body }}</td>
                        </tr>
                        <tr>
                            <td>response status code</td>
                            <td v-if="request.responseSent">{{ request.responseStatusCode }}</td>
                            <td v-else>
                                <input v-model="request.responseStatusCode"/>
                            </td>
                        </tr>
                        <tr>
                            <td>response json</td>
                            <td v-if="request.responseSent">{{ request.responseJson }}</td>
                            <td v-else>
                                <textarea v-model="request.responseJson"></textarea>
                            </td>
                        </tr>
                        <td>
                            <td v-if="request.responseSent" class="text-success">response sent!</td>
                            <td v-else>
                                <button @click="sendResponse(request)">send response</button>
                            </td>
                        </td>
                    </table>
                </li>
            </ul>
        </div>
    </body>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                serverId: '',
                serverUrl: '',
                requests: []
            },
            methods: {
                sendResponse: function(request) {
                    ws.send(JSON.stringify({
                        requestKey: request.requestKey, 
                        statusCode: request.responseStatusCode, 
                        json: request.responseJson
                    }));
                    request.responseSent = true;
                }
            }
        });

        const ws = new WebSocket(location.origin.replace(/^http/, 'ws'));
        ws.onmessage = function (event) {
            console.log(app);
            const message = JSON.parse(event.data);
            if (message.requestKey) {
                const request = message;
                request.responseStatusCode = 200;
                request.responseJson = '{}';
                request.responseSent = false;
                app.requests.push(request);
            } else {
                app.serverId = message.serverId;
                app.serverUrl = location.origin + '/' + message.serverId;
            }
        }
    </script>
</html>