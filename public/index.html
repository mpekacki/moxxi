<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
        integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
        crossorigin="anonymous" /> -->
    <!-- CSS Reset -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/dark.css">
    <!-- <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css"> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tufte-css/1.7.2/tufte.min.css" integrity="sha512-cG7Z4degp9718dDjGjeJmar0+g7RtE/olDe0VRKEFDtOEkm91JSvE7ZxN2+sijkU0AAK3e2xzu7bafBGC/uiqA==" crossorigin="anonymous" /> -->
    <!-- <link rel="stylesheet" href="https://gitcdn.link/repo/Chalarangelo/mini.css/master/dist/mini-default.css" /> -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/picnic@6.5.3/picnic.min.css"> -->

    <!-- Google Fonts -->
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic"> -->

    <!-- CSS Reset -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"> -->

    <!-- Milligram CSS -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css"> -->

    <!-- <link rel="stylesheet" href="/public/dark.css"> -->

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.1.3/jsoneditor.css" integrity="sha512-C4lyyyM6oEazFSIdZ4N8klIgD0frXwgcSh4hxlflXw8trQVlZ8M2etLv/TxupDhepsgjdLMbMfGmaB4UxnderA==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.1.3/jsoneditor.js" integrity="sha512-1UW+LVrkFHEx/ZjoEfXqnZGi73LPOdOnHqgT7eUj9SjE/sgjI97s/K/Fpwd4HCZfDIPWa2fXnzg1cfINuoOJ/w==" crossorigin="anonymous"></script> -->
</head>

<style>
    body {
        max-width: 1140px;
    }
</style>

<body>
    <div id="app" class="container">
        Your unique endpoint is <input v-model="serverUrl" readonly="true" onClick="this.select();"
            style="width: 100%" />
        <div v-if="!requests.length">
            <hr>
            Requests made to your endpoint will appear here
        </div>
        <div v-for="request in requests" class="list-group-item">
            <hr>
            <table class="table">
                <tr>
                    <td colspan="2">
                        <table>
                            <tr>
                                <th colspan="2">Request</th>
                            </tr>
                            <tr>
                                <td>url</td>
                                <td>{{ request.url }}</td>
                            </tr>
                            <tr>
                                <td>method</td>
                                <td>{{ request.method }}</td>
                            </tr>
                            <tr>
                                <td>headers</td>
                                <td>
                                    <textarea readonly="true" v-model="request.headers"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td>params</td>
                                <td>{{ request.params }}</td>
                            </tr>
                            <tr>
                                <td>body</td>
                                <td>{{ request.body }}</td>
                            </tr>
                            <tr>
                                <td>ip</td>
                                <td>{{ request.ip }}</td>
                            </tr>
                            <tr>
                                <td>protocol</td>
                                <td>{{ request.protocol }}</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table v-if="request.status === 'ResponseSent'">
                            <tr>
                                <th colspan="2">Response</th>
                            </tr>
                            <tr>
                                <td>response status code</td>
                                <td>{{ request.responseStatusCode }}</td>
                            </tr>
                            <tr>
                                <td>response json</td>
                                <td>{{ request.responseJson }}</td>
                            </tr>
                        </table>
                        <response-editor v-else-if="request.status === 'Open'" v-bind:status-code="request.responseStatusCode"
                            v-bind:json="request.responseJson"
                            v-bind:saved-responses="savedResponses"
                            v-on:jsoninput="request.responseJson = $event"
                            v-on:statuscodeinput="request.responseStatusCode = $event"></response-editor>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td v-if="request.status === 'ResponseSent'" class="text-success">response sent!</td>
                    <td v-else-if="request.status === 'Closed'">request closed by sender</td>
                    <td v-else>
                        <button @click="sendResponse(request)">send response</button>
                    </td>
                </tr>
            </table>
        </div>
</body>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            serverId: '',
            serverUrl: '',
            requests: [],
            savedResponses: [
                {
                    id: 0,
                    statusCode: 200,
                    json: '{}',
                    name: '200 {}'
                }
            ],
            biggestResponseId: 0
        },
        methods: {
            sendResponse: function (request) {
                ws.send(JSON.stringify({
                    requestKey: request.requestKey,
                    statusCode: request.responseStatusCode,
                    json: request.responseJson
                }));
                request.status = 'ResponseSent';
                this.saveResponse(request.responseStatusCode, request.responseJson);
            },
            saveResponse: function(statusCode, json) {
                try {
                    json = JSON.stringify(JSON.parse(json))
                } catch {}
                if (this.savedResponses.some(r => r.statusCode == statusCode && r.json == json)) {
                    return;
                }
                this.savedResponses.push({ id: ++this.biggestResponseId, statusCode: statusCode, json: json, name: statusCode + ' ' + json.substring(0, 50) });
            }
        }
    });

    Vue.component('response-editor', {
        data: function () {
            return {
                responseStatusCode: this.statusCode,
                responseJson: this.json,
                responses: this.savedResponses,
                selectedResponse: 0
            }
        },
        methods: {
            updateResponseSelection(statusCode, json) {
                const found = this.responses.find(r => r.statusCode == statusCode && r.json == json);
                this.selectedResponse = found ? found.id : null;
            }
        },
        watch: {
            responseStatusCode: function (val) {
                this.$emit('statuscodeinput', val);
                this.updateResponseSelection(val, this.responseJson);
            },
            responseJson: function (val) {
                this.$emit('jsoninput', val);
                this.updateResponseSelection(this.responseStatusCode, val);
            },
            selectedResponse: function (val) {
                const found = this.responses.find(r => r.id === val);
                if (found) {
                    this.responseStatusCode = found.statusCode;
                    this.responseJson = found.json;
                }
            }
        },
        props: ['statusCode', 'json', 'savedResponses'],
        template: `
            <table>
                <tr>
                    <th colspan="2">Response</th>
                </tr>
                <tr>
                    <td>
                        saved responses
                    </td>
                    <td>
                        <select v-model="selectedResponse">
                            <option value=""></option>
                            <option v-for="response in responses" v-bind:value="response.id">{{ response.name }}</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>response status code</td>
                    <td>
                        <input v-model="responseStatusCode" />
                        <div style="max-height: 10em; overflow-y: scroll;">
                            <div><input type="radio" id="100" value="100" v-model="responseStatusCode">
                                <label for="100">100 Continue</label></div>
                            <div><input type="radio" id="101" value="101" v-model="responseStatusCode">
                                <label for="101">101 Switching Protocols</label></div>
                            <div><input type="radio" id="102" value="102" v-model="responseStatusCode">
                                <label for="102">102 Processing</label></div>
                            <div><input type="radio" id="200" value="200" v-model="responseStatusCode">
                                <label for="200">200 OK</label></div>
                            <div><input type="radio" id="201" value="201" v-model="responseStatusCode">
                                <label for="201">201 Created</label></div>
                            <div><input type="radio" id="202" value="202" v-model="responseStatusCode">
                                <label for="202">202 Accepted</label></div>
                            <div><input type="radio" id="203" value="203" v-model="responseStatusCode">
                                <label for="203">203 Non-authoritative Information</label></div>
                            <div><input type="radio" id="204" value="204" v-model="responseStatusCode">
                                <label for="204">204 No Content</label></div>
                            <div><input type="radio" id="205" value="205" v-model="responseStatusCode">
                                <label for="205">205 Reset Content</label></div>
                            <div><input type="radio" id="206" value="206" v-model="responseStatusCode">
                                <label for="206">206 Partial Content</label></div>
                            <div><input type="radio" id="207" value="207" v-model="responseStatusCode">
                                <label for="207">207 Multi-Status</label></div>
                            <div><input type="radio" id="208" value="208" v-model="responseStatusCode">
                                <label for="208">208 Already Reported</label></div>
                            <div><input type="radio" id="226" value="226" v-model="responseStatusCode">
                                <label for="226">226 IM Used</label></div>
                            <div><input type="radio" id="300" value="300" v-model="responseStatusCode">
                                <label for="300">300 Multiple Choices</label></div>
                            <div><input type="radio" id="301" value="301" v-model="responseStatusCode">
                                <label for="301">301 Moved Permanently</label></div>
                            <div><input type="radio" id="302" value="302" v-model="responseStatusCode">
                                <label for="302">302 Found</label></div>
                            <div><input type="radio" id="303" value="303" v-model="responseStatusCode">
                                <label for="303">303 See Other</label></div>
                            <div><input type="radio" id="304" value="304" v-model="responseStatusCode">
                                <label for="304">304 Not Modified</label></div>
                            <div><input type="radio" id="305" value="305" v-model="responseStatusCode">
                                <label for="305">305 Use Proxy</label></div>
                            <div><input type="radio" id="307" value="307" v-model="responseStatusCode">
                                <label for="307">307 Temporary Redirect</label></div>
                            <div><input type="radio" id="308" value="308" v-model="responseStatusCode">
                                <label for="308">308 Permanent Redirect</label></div>
                            <div><input type="radio" id="400" value="400" v-model="responseStatusCode">
                                <label for="400">400 Bad Request</label></div>
                            <div><input type="radio" id="401" value="401" v-model="responseStatusCode">
                                <label for="401">401 Unauthorized</label></div>
                            <div><input type="radio" id="402" value="402" v-model="responseStatusCode">
                                <label for="402">402 Payment Required</label></div>
                            <div><input type="radio" id="403" value="403" v-model="responseStatusCode">
                                <label for="403">403 Forbidden</label></div>
                            <div><input type="radio" id="404" value="404" v-model="responseStatusCode">
                                <label for="404">404 Not Found</label></div>
                            <div><input type="radio" id="405" value="405" v-model="responseStatusCode">
                                <label for="405">405 Method Not Allowed</label></div>
                            <div><input type="radio" id="406" value="406" v-model="responseStatusCode">
                                <label for="406">406 Not Acceptable</label></div>
                            <div><input type="radio" id="407" value="407" v-model="responseStatusCode">
                                <label for="407">407 Proxy Authentication Required</label></div>
                            <div><input type="radio" id="408" value="408" v-model="responseStatusCode">
                                <label for="408">408 Request Timeout</label></div>
                            <div><input type="radio" id="409" value="409" v-model="responseStatusCode">
                                <label for="409">409 Conflict</label></div>
                            <div><input type="radio" id="410" value="410" v-model="responseStatusCode">
                                <label for="410">410 Gone</label></div>
                            <div><input type="radio" id="411" value="411" v-model="responseStatusCode">
                                <label for="411">411 Length Required</label></div>
                            <div><input type="radio" id="412" value="412" v-model="responseStatusCode">
                                <label for="412">412 Precondition Failed</label></div>
                            <div><input type="radio" id="413" value="413" v-model="responseStatusCode">
                                <label for="413">413 Payload Too Large</label></div>
                            <div><input type="radio" id="414" value="414" v-model="responseStatusCode">
                                <label for="414">414 Request-URI Too Long</label></div>
                            <div><input type="radio" id="415" value="415" v-model="responseStatusCode">
                                <label for="415">415 Unsupported Media Type</label></div>
                            <div><input type="radio" id="416" value="416" v-model="responseStatusCode">
                                <label for="416">416 Requested Range Not Satisfiable</label></div>
                            <div><input type="radio" id="417" value="417" v-model="responseStatusCode">
                                <label for="417">417 Expectation Failed</label></div>
                            <div><input type="radio" id="418" value="418" v-model="responseStatusCode">
                                <label for="418">418 I\'m a teapot</label></div>
                            <div><input type="radio" id="421" value="421" v-model="responseStatusCode">
                                <label for="421">421 Misdirected Request</label></div>
                            <div><input type="radio" id="422" value="422" v-model="responseStatusCode">
                                <label for="422">422 Unprocessable Entity</label></div>
                            <div><input type="radio" id="423" value="423" v-model="responseStatusCode">
                                <label for="423">423 Locked</label></div>
                            <div><input type="radio" id="424" value="424" v-model="responseStatusCode">
                                <label for="424">424 Failed Dependency</label></div>
                            <div><input type="radio" id="426" value="426" v-model="responseStatusCode">
                                <label for="426">426 Upgrade Required</label></div>
                            <div><input type="radio" id="428" value="428" v-model="responseStatusCode">
                                <label for="428">428 Precondition Required</label></div>
                            <div><input type="radio" id="429" value="429" v-model="responseStatusCode">
                                <label for="429">429 Too Many Requests</label></div>
                            <div><input type="radio" id="431" value="431" v-model="responseStatusCode">
                                <label for="431">431 Request Header Fields Too Large</label></div>
                            <div><input type="radio" id="444" value="444" v-model="responseStatusCode">
                                <label for="444">444 Connection Closed Without Response</label></div>
                            <div><input type="radio" id="451" value="451" v-model="responseStatusCode">
                                <label for="451">451 Unavailable For Legal Reasons</label></div>
                            <div><input type="radio" id="499" value="499" v-model="responseStatusCode">
                                <label for="499">499 Client Closed Request</label></div>
                            <div><input type="radio" id="500" value="500" v-model="responseStatusCode">
                                <label for="500">500 Internal Server Error</label></div>
                            <div><input type="radio" id="501" value="501" v-model="responseStatusCode">
                                <label for="501">501 Not Implemented</label></div>
                            <div><input type="radio" id="502" value="502" v-model="responseStatusCode">
                                <label for="502">502 Bad Gateway</label></div>
                            <div><input type="radio" id="503" value="503" v-model="responseStatusCode">
                                <label for="503">503 Service Unavailable</label></div>
                            <div><input type="radio" id="504" value="504" v-model="responseStatusCode">
                                <label for="504">504 Gateway Timeout</label></div>
                            <div><input type="radio" id="505" value="505" v-model="responseStatusCode">
                                <label for="505">505 HTTP Version Not Supported</label></div>
                            <div><input type="radio" id="506" value="506" v-model="responseStatusCode">
                                <label for="506">506 Variant Also Negotiates</label></div>
                            <div><input type="radio" id="507" value="507" v-model="responseStatusCode">
                                <label for="507">507 Insufficient Storage</label></div>
                            <div><input type="radio" id="508" value="508" v-model="responseStatusCode">
                                <label for="508">508 Loop Detected</label></div>
                            <div><input type="radio" id="510" value="510" v-model="responseStatusCode">
                                <label for="510">510 Not Extended</label></div>
                            <div><input type="radio" id="511" value="511" v-model="responseStatusCode">
                                <label for="511">511 Network Authentication Required</label></div>
                            <div><input type="radio" id="599" value="599" v-model="responseStatusCode">
                                <label for="599">599 Network Connect Timeout Error</label></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>response json</td>
                    <td>
                        <textarea v-model="responseJson"></textarea>
                    </td>
                </tr>
            </table>
        `
    });

    const ws = new WebSocket(location.origin.replace(/^http/, 'ws'));
    ws.onmessage = function (event) {
        console.log(event);
        try {
            const message = JSON.parse(event.data);
            if (message.requestKey) {
                const request = message;
                request.headers = JSON.stringify(request.headers, null, 2);
                const found = app.requests.find(r => r.requestKey === request.requestKey);
                if (found) {
                    found = Object.assign(found, request);
                } else {
                    request.responseStatusCode = 200;
                    request.responseJson = '{}';
                    app.requests.unshift(request);
                }
            } else if (message.serverId) {
                app.serverId = message.serverId;
                app.serverUrl = location.origin + '/' + message.serverId;
            }
        } catch { }
    }
</script>

</html>